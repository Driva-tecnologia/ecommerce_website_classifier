# Bases de Dados

## Conjuntos de Treinamento

Os conjuntos de treinamento foram criados da seguinte maneira:

- `conjunto com dados validados e sem ruído` (o modelo treinado nessa base se chama `MODEL_v1_ecommerce_tfidf_vectorizer_multinomial_nb_custom_lemmatizer_3_True_42_1000_training_data.pkl`): Foram selecionados 5000 domínios com alta probabilidade de serem e-commerce (80%+) e 5000 domínios com baixa probabilidade de serem e-commerce (20%-). Esses domínios foram tratados e limpos para poder extrair o seu HTML, utilizado para rotular os dados por meio de um software que faz a captura de tela de cada site. Por fim, uma parte desses dados foram rotulados manualmente para compor o conjunto de treino e outra pequena parte para compor o conjunto de treinamento. No final, o conjunto de treinamento possui, aproximadamente, mil dados.

- `conjunto com dados validados e sem ruído + conjunto de dados extra` (o modelo treinado nessa base se chama `MODEL_v1_ecommerce_tfidf_vectorizer_multinomial_nb_custom_lemmatizer_3_True_42_1000_training_data_extra_samples.pkl`): Foram selecionados 5000 domínios com baixa probabilidade de serem e-commerce (10 a 30%) e outros 5000 domínios com média probabilidade de serem e-commerce (30 a 60%). Esses domínios foram tratados e limpos para poder extrair o seu HTML, utilizado para rotular os dados por meio de um software que faz a captura de tela de cada site. Esse conjunto possui, aproximadamente, mais mil dados.

- `conjunto de dados ruídosos` (o modelo treinado nessa base se chama `MODEL_v1_ecommerce_tfidf_vectorizer_multinomial_nb_custom_lemmatizer_3_True_42_1000_noisy_training_data.pkl`): Foram selecionados aleatoriamente 20mil domínios, que foram tratados e limpos para poder extrair o seu HTML, utilizando os tokens pré-processados (extraídos do HTML) para serem classificados automaticamente pelo ChatGPT 4o-mini. Esse conjunto possui, aproximadamente, 4.800 dados.

Algumas informações da composição cada base:

- `Conjunto com dados validados e sem ruído`:
    - Tamanho: 1105
    - Quantidade de dados da classe `e-commerce`: 387
    - Quantidade de dados da classe `não é e-commerce`: 718

- `Conjunto de dados extra`:
    - Tamanho: 1056
    - Quantidade de dados da classe `e-commerce`: 130
    - Quantidade de dados da classe `não é e-commerce`: 926

- `Conjunto com dados validados e sem ruído + conjunto de dados extra`:
    - Tamanho: 2161
    - Quantidade de dados da classe `e-commerce`: 517
    - Quantidade de dados da classe `não é e-commerce`: 1644

- `Conjunto de dados ruídosos`:
    - Tamanho: 4760
    - Quantidade de dados da classe `e-commerce`: 1154
    - Quantidade de dados da classe `não é e-commerce`: 3606

## Conjuntos de Validação

Como os conjuntos de testes e validação usados para treinar o modelo que está em produção atualmente não foi encontrado, optou-se pela criação e utilização de outros conjuntos. É importante ressaltar que como os dados foram rotulados manualmente, é possível que alguns dos domínios tenha sido classificado erroneamente, já que esse é um risco presente na validação manual e também porque o software que realiza a captura de tela da página inicial de cada site (junto com a parte de rotulação) não funcionou perfeitamente para todos os dados disponíveis. Sendo assim, os conjuntos de validação foram criados da seguinte maneira:

- `Conjunto de validação criado manualmente`: Alguns domínios que não estavam presentes em nenhum conjunto de treinamento foram extraídos da tabela do Postgres e selecionados aleatoriamente para serem rotulados, visando montar uma base maior de validação dos modelos.

- `Dados análise de probabilidade da Pagar.me`: Foram utilizados os dados da [planilha de análise de probabilidade](https://docs.google.com/spreadsheets/d/16ubQaRJ9deGMtZ7OnTqgDigokKJCr3gm/edit?usp=sharing&ouid=106046294543553797804&rtpof=true&sd=true) para validação dos modelos. É importante ressaltar que não foram utilizados todos os websites, pois estava inválido ou não foi possível obter o seu HMTL usando o spiderwebv4. Esses dados foram avaliados e rotulados pela equipe de CS.

- `Dados análise de probabilidade da Pagar.me (Lista 8)`: Foram utilizados os dados da [planilha de análise de probabilidade](https://docs.google.com/spreadsheets/d/1g5nSRi236JaLsL-M74TBolhoSTvzn0vHd3qB3Caie7c/edit?usp=sharing) para validação dos modelos. É importante ressaltar que não foram utilizados todos os websites, pois estava inválido, offline ou não foi possível obter o seu HMTL usando o spiderwebv4. Esses dados foram avaliados e rotulados pela equipe de CS.

- `Dados da Pagar.me`: Para testar os modelos, foram utilizados os dados da [planilha de domínio](https://docs.google.com/spreadsheets/d/1ZGQe8Ia_6pZ8IMMKWJbjB5EEfbWcq_vAixxApEjjDn8/edit?usp=sharing) que foram rotulados como não sendo e-commerce. Esses dados foram avaliados e rotulados pela equipe de CS. É importante mencionar que não foram utilizados dados rotulados de e-commerce, pois não foram encontrados rótulos que especificassem se o domínio era e-commerce. 

Algumas informações da composição cada base:

- `Conjunto de validação criado manualmente`:
    - Tamanho: 340
    - Quantidade de dados da classe `e-commerce`: 141
    - Quantidade de dados da classe `não é e-commerce`: 199

- `Dados análise de probabilidade da Pagar.me`:
    - Tamanho: 68
    - Quantidade de dados da classe `e-commerce`: 27
    - Quantidade de dados da classe `não é e-commerce`: 41

- `Dados análise de probabilidade da Pagar.me (Lista 8)`:
    - Tamanho: 122
    - Quantidade de dados da classe `e-commerce`: 50
    - Quantidade de dados da classe `não é e-commerce`: 72

- `Dados da Pagar.me`:
    - Tamanho: 14
    - Quantidade de dados da classe `e-commerce`: 0
    - Quantidade de dados da classe `não é e-commerce`: 14

# Resultados no Conjunto de Validação

Para todas as tabelas desse relatório, considere que os melhores resultados estão em negrito.

## Conjunto de Validação

### Acurácia

| Threshold / Modelo 	| Treinado com Dados Validados + Dados Extras 	| Treinado com Dados Validados 	| Treinado com Dados Ruidosos 	| Modelo Atual 	|
|:------------------:	|:-------------------------------------------:	|------------------------------	|-----------------------------	|--------------	|
|         0.4        	| **0.9441**                                      	| 0.9324                       	| 0.9235                      	| 0.9059       	|
|         0.5        	| 0.9294                                      	| **0.9382**                       	| 0.9088                      	| 0.9118       	|
|         0.6        	| 0.9265                                      	| **0.9382**                       	| 0.9029                      	| 0.9118       	|
|         0.7        	| 0.9206                                      	| **0.9353**                       	| 0.9029                      	| 0.9147       	|
|         0.8        	| 0.9                                         	| **0.9235**                       	| 0.8882                      	| **0.9235**       	|
|         0.9        	| 0.8647                                      	| 0.9029                       	| 0.8647                      	| **0.9059**       	|

### F1-Score

| Threshold / Modelo 	| Treinado com Dados Validados + Dados Extras 	| Treinado com Dados Validados 	| Treinado com Dados Ruidosos 	| Modelo Atual 	|
|:------------------:	|:-------------------------------------------:	|------------------------------	|-----------------------------	|--------------	|
|         0.4        	| **0.9324**                                      	| 0.9199                       	| 0.9044                      	| 0.8947       	|
|         0.5        	| **0.9324**                                      	| 0.9263                       	| 0.8839                      	| 0.9007       	|
|         0.6        	| 0.9084                                      	| **0.9258**                       	| 0.8726                      	| 0.9007       	|
|         0.7        	| 0.8989                                      	| **0.9209**                       	| 0.8696                      	| 0.9037       	|
|         0.8        	| 0.8651                                      	| 0.903                        	| 0.8455                      	| **0.9122**       	|
|         0.9        	| 0.8067                                      	| 0.8706                       	| 0.8067                      	| **0.8824**       	|

### Falso Positivo

| Threshold / Modelo 	| Treinado com Dados Validados + Dados Extras 	| Treinado com Dados Validados 	| Treinado com Dados Ruidosos 	| Modelo Atual 	|
|:------------------:	|:-------------------------------------------:	|------------------------------	|-----------------------------	|--------------	|
|         0.4        	| 9                                  	| 14                   	| **8**                  	| 27   	|
|         0.5        	| **8**                                  	| 12                   	| **8**                  	| 25   	|
|         0.6        	| 8                                  	| 11                  	| **5**                  	| 25   	|
|         0.7        	| 6                                  	| 9                   	| **2**                  	| 24   	|
|         0.8        	| 2                                  	| 6                   	| **1**                  	| 20   	|
|         0.9        	| **1**                                  	| 3                   	| **1**                  	| 11  	|

### Falso Negativo

| Threshold / Modelo 	| Treinado com Dados Validados + Dados Extras 	| Treinado com Dados Validados 	| Treinado com Dados Ruidosos 	| Modelo Atual 	|
|:------------------:	|:-------------------------------------------:	|------------------------------	|-----------------------------	|--------------	|
|         0.4        	| 10                                  	| 9                   	| 18                  	| **5**   	|
|         0.5        	| 16                                  	| 9                   	| 23                  	| **5**   	|
|         0.6        	| 17                                  	| 10                  	| 28                  	| **5**   	|
|         0.7        	| 21                                  	| 13                   	| 31                  	| **5**   	|
|         0.8        	| 32                                  	| 20                   	| 37                  	| **6**   	|
|         0.9        	| 45                                  	| 30                   	| 45                  	| **21**  	|

## Dados da Análise de Probabilidade

### Acurácia

| Threshold / Modelo 	| Treinado com Dados Validados + Dados Extras 	| Treinado com Dados Validados 	| Treinado com Dados Ruidosos 	| Modelo Atual 	|
|:------------------:	|:-------------------------------------------:	|------------------------------	|-----------------------------	|--------------	|
|         0.4        	| **0.7353**                                      	| 0.6765                       	| 0.6912                      	| 0.6324       	|
|         0.5        	| **0.7206**                                      	| 0.6912                       	| **0.7206**                      	| 0.6471       	|
|         0.6        	| 0.7059                                      	| **0.7206**                       	| 0.7059                      	| 0.6324        	|
|         0.7        	| **0.7206**                                      	| 0.7059                       	| 0.6912                      	| 0.6912       	|
|         0.8        	| **0.7059**                                      	| **0.7059**                       	| 0.6618                       	| 0.6912       	|
|         0.9        	| 0.6618                                       	| **0.7059**                       	| 0.6471                      	| 0.6765        	|

### F1-Score

| Threshold / Modelo 	| Treinado com Dados Validados + Dados Extras 	| Treinado com Dados Validados 	| Treinado com Dados Ruidosos 	| Modelo Atual 	|
|:------------------:	|:-------------------------------------------:	|------------------------------	|-----------------------------	|--------------	|
|         0.4        	| 0.55                                      	| 0.5217                       	| 0.4324                      	| **0.5614**       	|
|         0.5        	| **0.5128**                                      	| 0.5116                       	| 0.4571                       	| 0.4286        	|
|         0.6        	| 0.4737                                      	| **0.5128**                       	| 0.4118                       	| 0.359       	|
|         0.7        	| **0.4865**                                         	| 0.4737                       	| 0.3636                       	| 0.4       	|
|         0.8        	| 0.4444                                         	| **0.4737**                       	| 0.2581                        	| 0.4       	|
|         0.9        	| 0.2581                                        	| **0.4118**                        	| 0.2                      	| 0.3529       	|

### Falso Positivo

| Threshold / Modelo 	| Treinado com Dados Validados + Dados Extras 	| Treinado com Dados Validados 	| Treinado com Dados Ruidosos 	| Modelo Atual 	|
|:------------------:	|:-------------------------------------------:	|------------------------------	|-----------------------------	|--------------	|
|         0.4        	| **2**                                  	| 7                   	| **2**                  	| 14   	|
|         0.5        	| 2                                  	| 5                   	| **0**                  	| 6   	|
|         0.6        	| 2                                  	| 2                   	| **0**                  	| 6   	|
|         0.7        	| 2                                  	| 2                   	| **0**                  	| 1   	|
|         0.8        	| 1                                  	| 2                   	| **0**                  	| 1   	|
|         0.9        	| **0**                                  	| **0**                   	| **0**                  	| 1   	|

### Falso Negativo

| Threshold / Modelo 	| Treinado com Dados Validados + Dados Extras 	| Treinado com Dados Validados 	| Treinado com Dados Ruidosos 	| Modelo Atual 	|
|:------------------:	|:-------------------------------------------:	|------------------------------	|-----------------------------	|--------------	|
|         0.4        	| 16                                  	| 15                   	| 19                  	| **11**   	|
|         0.5        	| 17                                  	| **16**                   	| 19                  	| 18   	|
|         0.6        	| 18                                  	| **17**                   	| 20                  	| 20   	|
|         0.7        	| **18**                                  	| **18**                   	| 21                  	| 20   	|
|         0.8        	| 19                                  	| **18**                   	| 23                  	| 20   	|
|         0.9        	| 23                                  	| **20**                   	| 24                  	| 21   	|

## Dados da Análise de Probabilidade (Lista 8)

### Acurácia

| Threshold / Modelo 	| Treinado com Dados Validados + Dados Extras 	| Treinado com Dados Validados 	| Treinado com Dados Ruidosos 	| Modelo Atual 	|
|:------------------:	|:-------------------------------------------:	|------------------------------	|-----------------------------	|--------------	|
|         0.4        	| **0.7295**                                     	| 0.6557                      	| 0.6148                     	| 0.4754       	|
|         0.5        	| **0.7377**                                     	| 0.7049                      	| 0.6148                     	| 0.541       	|
|         0.6        	| **0.7377**                                     	| 0.6803                       	| 0.6148                      	| 0.5574        	|
|         0.7        	| **0.6639**                                      	| 0.6475                       	| 0.623                      	| 0.6066       	|
|         0.8        	| 0.6148                                      	| 0.6148                       	| **0.6311**                       	| **0.6311**       	|
|         0.9        	| 0.623                                       	| 0.6148                       	| **0.6311**                      	| 0.623        	|

### F1-Score

| Threshold / Modelo 	| Treinado com Dados Validados + Dados Extras 	| Treinado com Dados Validados 	| Treinado com Dados Ruidosos 	| Modelo Atual 	|
|:------------------:	|:-------------------------------------------:	|------------------------------	|-----------------------------	|--------------	|
|         0.4        	| **0.6207**                                      	| 0.5532                       	| 0.2295                      	| 0.5789       	|
|         0.5        	| **0.5897**                                      	| 0.5714                       	| 0.2034                       	| 0.5758        	|
|         0.6        	| **0.5789**                                      	| 0.4658                       	| 0.2034                       	| 0.3721       	|
|         0.7        	| **0.3881**                                         	| 0.3582                       	| 0.2069                       	| 0.3143       	|
|         0.8        	| 0.2295                                         	| 0.2295                       	| 0.2105                        	| **0.2623**      	|
|         0.9        	| 0.1786                                        	| 0.2034                        	| 0.2105                      	| **0.2333**       	|

### Falso Positivo

| Threshold / Modelo 	| Treinado com Dados Validados + Dados Extras 	| Treinado com Dados Validados 	| Treinado com Dados Ruidosos 	| Modelo Atual 	|
|:------------------:	|:-------------------------------------------:	|------------------------------	|-----------------------------	|--------------	|
|         0.4        	| 10                                  	| 18                   	| **4**                  	| 58   	|
|         0.5        	| 5                                  	| 10                   	| **3**                  	| 44   	|
|         0.6        	| 4                                  	| 6                   	| **3**                  	| 20   	|
|         0.7        	| 4                                  	| 5                   	| **2**                  	| 9   	|
|         0.8        	| 4                                  	| 4                   	| **1**                  	| 3   	|
|         0.9        	| **1**                                  	| 3                   	| **1**                  	| 3   	|

### Falso Negativo

| Threshold / Modelo 	| Treinado com Dados Validados + Dados Extras 	| Treinado com Dados Validados 	| Treinado com Dados Ruidosos 	| Modelo Atual 	|
|:------------------:	|:-------------------------------------------:	|------------------------------	|-----------------------------	|--------------	|
|         0.4        	| 23                                  	| 24                   	| 43                  	| **6**   	|
|         0.5        	| 27                                  	| 26                   	| 44                  	| **12**   	|
|         0.6        	| **28**                                  	| 33                   	| 44                  	| 34   	|
|         0.7        	| **37**                                  	| 38                   	| 44                  	| 39   	|
|         0.8        	| 43                                  	| 43                   	| 44                  	| **42**   	|
|         0.9        	| 45                                  	| 44                   	| 44                  	| **43**   	|

## Dados da Pagar.me (Somente Acurácia)

| Threshold / Modelo 	| Treinado com Dados Validados + Dados Extras 	| Treinado com Dados Validados 	| Treinado com Dados Ruidosos 	| Modelo Atual 	|
|:------------------------:	|:-------------------------------------------:	|------------------------------	|-----------------------------	|--------------	|
|            0.4           	| 0.7143                                      	| 0.6429                       	| **1**                           	| 0.4286       	|
|            0.5           	| 0.8571                                      	| 0.8571                       	| **1**                           	| 0.5714       	|
|            0.6           	| 0.9286                                      	| 0.8571                       	| **1**                           	| 0.7143       	|
|            0.7           	| **1**                                           	| 0.9286                       	| **1**                           	| 0.7143       	|
|            0.8           	| **1**                                           	| 0.9286                       	| **1**                           	| 0.9286       	|
|            0.9           	| **1**                                           	| **1**                            	| **1**                           	| 0.9286       	|

# Resultados no Conjunto de Teste (KFold)

Como os conjuntos de treinamento, testes e validação usados para treinar o modelo que está em produção atualmente não foi encontrado, optou-se por utilizar o conjunto de teste do KFold do índice que obteve o melhor resultado para realizar uma comparação extra entre os novos modelos candidatos e o modelo atual (`MODEL_ecommerce_tfidf_vectorizer_mnb_custom_lemmatizer_3_True_42_1000_spiderwebv4_dataset_html.pkl`). É importante reforçar que, como o algoritmo não utiliza uma base de teste específico e a não existência de um conjunto de teste, os conjuntos de testes foram diferentes entre os modelos, visto que a técnica do KFold faz a separação dos dados de acordo com a distribuição das classes. Posto isso, só foi possível realizar a comparação do modelo atual pareado com os modelos candidatos, e não todos entre si. Essa limitação foi mitigada posteriormente com a criação de conjuntos de validação. As matrizes de confusão dos modelos candidatos nos dados de treinamento do KFold estão disponíveis no appendix, localizado no final do documento.

## Acurácia

| Threshold / Modelo 	| Treinado com Dados Validados + Dados Extras vs Modelo Atual 	| Treinado com Dados Validados vs Modelo Atual 	| Treinado com Dados Ruidosos vs Modelo Atual 	|
|:------------------:	|:-----------------------------------------------------------:	|----------------------------------------------	|---------------------------------------------	|
|         0.4        	| **0.9158** / 0.8174                                             	| **0.9241** / 0.9133                              	| **0.9011** / 0.7984                             	|
|         0.5        	| **0.9244** / 0.8645                                             	| **0.9322** / 0.9160                              	| **0.9036** / 0.8469                             	|
|         0.6        	| **0.9244** / 0.8802                                             	| **0.9322**  / 0.9106                             	| **0.9112** / 0.8652                             	|
|         0.7        	| **0.9087** / 0.8930                                             	| **0.9350** / 0.9106                              	| **0.9105** / 0.8771                             	|
|         0.8        	| **0.8987** / 0.8973                                             	| **0.9377** / 0.9160                              	| **0.9074** / 0.8859                             	|
|         0.9        	| 0.8845 / **0.9073**                                             	| 0.9187 / **0.9214**                              	| **0.8992** / 0.8929                             	|

## F1-Score

| Threshold / Modelo 	| Treinado com Dados Validados + Dados Extras vs Modelo Atual 	| Treinado com Dados Validados vs Modelo Atual 	| Treinado com Dados Ruidosos vs Modelo Atual 	|
|:------------------:	|:-----------------------------------------------------------:	|----------------------------------------------	|---------------------------------------------	|
|         0.4        	| **0.826** / 0.6995                                  	| **0.8986** / 0.8873                   	| **0.8177** / 0.7015            	|
|         0.5        	| **0.834** / 0.7532                                   	| **0.9077** / 0.8905                    	| **0.8172** / 0.7553               	|
|         0.6        	| **0.8296** / 0.7614                                   	| **0.9064** / 0.8826                   	| **0.827** / 0.7775                 	|
|         0.7        	| **0.7852** / 0.7788                                 	| **0.9062** / 0.8826                 	| **0.8212** / 0.7923               	|
|         0.8        	| 0.7526 / **0.7857**                                  	| **0.9084** / 0.8889                    	| **0.8083** / 0.8                    	|
|         0.9        	| 0.7011/ **0.7949**                                  	| 0.876 / **0.8897**                    	| 0.7778 / **0.8014**         	|

## Falso Positivo

| Threshold / Modelo 	| Treinado com Dados Validados + Dados Extras vs Modelo Atual 	| Treinado com Dados Validados vs Modelo Atual 	| Treinado com Dados Ruidosos vs Modelo Atual 	|
|:------------------:	|:-----------------------------------------------------------:	|----------------------------------------------	|---------------------------------------------	|
|         0.4        	| **30** / 108                                                    	| **23** / 29                                      	| **124** / 311                                   	|
|         0.5        	| **18** / 71                                                     	| **19** / 28                                      	| **110** / 233                                   	|
|         0.6        	| **13** / 49                                                     	| **17** / 28                                      	| **93** / 203                                    	|
|         0.7        	| **12** / 38                                                     	| **11** / 28                                      	| **83** / 182                                    	|
|         0.8        	| **10** / 35                                                     	| **8** / 26                                       	| **72** / 158                                    	|
|         0.9        	| **7** / 19                                                      	| **7** / 17                                       	| **55** / 128                                    	|

## Falso Negativo

| Threshold / Modelo 	| Treinado com Dados Validados + Dados Extras vs Modelo Atual 	| Treinado com Dados Validados vs Modelo Atual 	| Treinado com Dados Ruidosos vs Modelo Atual 	|
|:------------------:	|:-----------------------------------------------------------:	|----------------------------------------------	|---------------------------------------------	|
|         0.4        	| 29 / **20**                                                 	| 5 / **3**                                    	| 33 / **9**                                  	|
|         0.5        	| 35 / **24**                                                 	| 6 / **3**                                    	| 43 / **10**                                 	|
|         0.6        	| 40 / **35**                                                 	| 8 / **5**                                    	| 48 / **11**                                 	|
|         0.7        	| 52 / **37**                                                 	| 13 / **5**                                   	| 59 / **13**                                 	|
|         0.8        	| 61 / **37**                                                 	| 15 / **5**                                   	| 75 / **23**                                 	|
|         0.9        	| 74 / **45**                                                 	| 23 / **12**                                  	| 105 / **42**                                	|

# Análise dos Resultados do Melhor Modelo

Nas seções anteriores, é possível observar que todos os modelos candidatos performaram melhor que o modelo atual. Além disso, também é notável que o modelo atual tem uma performance melhor que todos os candidatos quando olhamos apenas para a quantidade de falso negativo, porém o cenário é o oposto quando olhamos para as outras métricas, principalmente a quantidade de falso positivo. Posto isso, optou-se **por escolher o modelo que foi treinado apenas nos dados validados**, visto que ele teve um resultado muito bom em todos os conjuntos de teste, além de, entre os modelos candidatos, ser o que tem o melhor trade-off entre falso negativo e falso positivo. Em relação ao valor do threshold, optou-se por escolher o valor **0.6** por estar entre os que tiveram os melhores resultados em todas as bases de validação e na de teste do KFold, além de reduzir a quantidade de informação presente nesse relatório. Porém, é importante ressaltar que o valor padrão do threshold (0.5) também obteve uma alta performance, podendo ser uma outra escolha no lugar do 0.6. Como a base de dados da Pagar.me possui somente dados de uma classe, ela não será utilizada nessa seção. Por fim, as análises a seguir foram realizadas utilizando o modelo treinado apenas na base de dados com dados validados (sem a base extra) e usando 0.6 como valor do threshold.

## Comparação das Matrizes de Confusão da Base de Dados do Conjunto de Validação do Melhor Modelo e do Modelo Atual

Nas matrizes de confusão abaixo, é possível observar que o mmelhor modelo possui uma performance melhor que o modelo atual, tanto considerando métricas específicas, como a acurácia e o F1-Score (ambos foram citados nas tabelas da seção anterior), quanto na quantidade de falso positivo, verdadeiro negativo (dados classificados corretamente como não sendo e-commerce) e verdadeiro positivo (dados classificados corretamente como sendo e-commerce). A única métrica que teve um resultado pior comparado ao modelo atual foi a quantidade de falso negativo.

![Comparação das Matrizes de Confusão da Base de Dados do Conjunto de Validação do Melhor Modelo e do Modelo Atual](../images/16-04-2025/confusion_matrix_dados_validacao.png)

## Comparação das Matrizes de Confusão da Base de Dados de Análise de Probabilidade do Melhor Modelo e do Modelo Atual

Nas matrizes de confusão abaixo, é possível observar que o mmelhor modelo possui uma performance melhor que o modelo atual, tanto considerando métricas específicas, como a acurácia e o F1-Score (ambos foram citados nas tabelas da seção anterior), quanto na quantidade de falso positivo, falso negativo, verdadeiro negativo (dados classificados corretamente como não sendo e-commerce) e verdadeiro positivo (dados classificados corretamente como sendo e-commerce).

![Comparação das Matrizes de Confusão da Base de Dados de Análise de Probabilidade do Melhor Modelo e do Modelo Atual](../images/16-04-2025/confusion_matrix_dados_analise_probabilidade.png)

## Comparação das Matrizes de Confusão da Base de Dados de Análise de Probabilidade (Lista 8) do Melhor Modelo e do Modelo Atual

Nas matrizes de confusão abaixo, é possível observar que o mmelhor modelo possui uma performance melhor que o modelo atual, tanto considerando métricas específicas, como a acurácia e o F1-Score (ambos foram citados nas tabelas da seção anterior), quanto na quantidade de falso positivo, falso negativo, verdadeiro negativo (dados classificados corretamente como não sendo e-commerce) e verdadeiro positivo (dados classificados corretamente como sendo e-commerce).

![Comparação das Matrizes de Confusão da Base de Dados de Análise de Probabilidade (Lista 8) do Melhor Modelo e do Modelo Atual](../images/16-04-2025/confusion_matrix_dados_analise_probabilidade_lista8.png)

## Comparação das Probabilidades do Melhor Modelo e do Modelo Atual em Websites Aleatórios do Banco de Dados

Para essa análise foram extraídas aleatoriamente 15 websites da tabela Postgres e a probabilidade da saída de ambos modelos serão comparados, a fim de visualizar se o melhor modelo está mais confiante dos resultados quando comparado com o modelo atual. No geral, é possível perceber que quando o website não é e-commerce a probabilidade do melhor modelo ficou menor do que as do modelo atual. Quando o website é e-commerce, a probabilidade do melhor modelo fica próxima ou maior que a probabilidade do modelo atual, com exceção do website `dontstop.com.br` onde a probabilidade ficou 6% menor, porém ainda ficou com uma confiança alta e que passaria por todos os thresholds avaliados. Dentre esses casos, é interessante ressaltar dois:

- O website `migcosmeticos.com.br` é muito parecido com e-commerce, contendo uma aba de produtos e tudo mais, mas não é um e-commerce já que não é possível realizar a compra de nenhum produto pelo site (o preço dos produtos também não está disponível), pois a compra é redirecionada para o WhatsApp. É interessante observar que o modelo dá uma probabilidade muito baixa para esse website, mesmo ele sendo muito parecido com um site de e-commerce. Por outro lado, o modelo atual classificaria esse website como e-commerce.
- O website `sonataacessorios.com.br` não está disponível (aparece a mensagem do Shopify dizendo que a loja não está disponível) e o melhor modelo apresenta uma probabilidade maior do que o do modelo atual, apesar de mesmo assim não classificá-lo como e-commerce. Uma hipótese para isso é de que o website possa ter sido de um e-commerce (pelo nome dá para inferir que era uma loja que vendia acessórios) e que ainda possa ter elementos de e-commerce no seu HTML, ou possam existir outros exemplos no conjunto de dados que possam apresentar um HTML muito parecido e de também estar classificado como e-commerce, visto que Shopify é muito utilizado para a criação de websites para e-commerce.

|            Website            	| Probabilidade do Melhor Modelo 	| Probabilidade do Modelo Atual 	| E-commerce? 	|
|:-----------------------------:	|:------------------------------:	|-------------------------------	|-------------	|
|       artursousa.adv.br       	|             0.0006             	|             0.0085            	|       Não      	|
|   cetesaescolatecnica.com.br  	|             0.0011             	|             0.0145            	|       Não      	|
|        6wseguros.com.br       	|             0.0346             	|             0.1016            	|       Não      	|
|       homevidamoc.com.br      	|             0.0019             	|             0.0189            	|       Não      	|
|      cidadeesertao.com.br     	|             0.9804             	|             0.9986            	|       Sim      	|
|     escoladovicejar.com.br    	|              0.006             	|             0.0199            	|       Não      	|
|    sonataacessorios.com.br    	|             0.4462             	|             0.2359            	|   Indisponível    	|
| servidorserracorretora.com.br 	|              0.011             	|             0.0922            	|       Não      	|
|        mistisexy.com.br       	|             0.9943             	|             0.9637            	|       Sim      	|
|         ionsign.com.br        	|             0.0085             	|             0.0529            	|       Não      	|
|     uniodontopocos.com.br     	|             0.0014             	|             0.0155            	|       Não      	|
|        dontstop.com.br        	|             0.9128             	|             0.9727            	|       Sim      	|
|       aggression.com.br       	|             0.9997             	|             0.9999            	|       Sim      	|
|      migcosmeticos.com.br     	|             0.1907             	|             0.6253            	|       Não      	|
|   aluminiofortbrilho.com.br   	|             0.9922             	|             0.9993            	|       Sim      	|

## Comparação das Probabilidades do Melhor Modelo e do Modelo Atual nos Dados da Pagar.me

As probabilidades do modelo para cada website fornecido nas planilhas se encontram nas planilhas originais ([planilha de análise de probabilidade da Pagar.me Lista 8](https://docs.google.com/spreadsheets/d/1g5nSRi236JaLsL-M74TBolhoSTvzn0vHd3qB3Caie7c/edit?usp=sharing) e [planilha de análise de probabilidade da Pagar.me](https://docs.google.com/spreadsheets/d/16ubQaRJ9deGMtZ7OnTqgDigokKJCr3gm/edit?usp=sharing&ouid=106046294543553797804&rtpof=true&sd=true)). É importante ressaltar que os dados das probabilidades do modelo atual foram fornecidos pelo time de CS, então o modelo atual não foi executado novamente para esses websites, e que os sites que não foram selecionados (seja porque estavam marcados como offline, em construção ou por terem sido rejeitados pelo algoritmo spiderwebv4 por estarem offline) estão marcados como "-" na planilha. 

Algumas observações podem ser feitas dos resultados que foram obtidos:

- O objetivo do modelo de reduzir a quantidade de ocorrência de falso positivo foi concluída com êxito e a ocorrência de falso negativo (websites de e-commerce que foram classificados como não e-commerce pelo modelo) é normal dado o objetivo principal;
- Nas planilhas não existe as datas de quando foram feitos os rótulos dos websites e isso pode causar uma divergência na comparação dos resultados obtidos pelo modelo, visto que o HTML do site pode mudar drásticamente de um dia por outro. Exemplo: um modelo pode ter sido classificado como e-commerce no dia 15/04/2025, porém no dia 16/04/2025 a loja foi derrubada e o site foi extinto. Se o HTML do site for obtido a partir do dia 16/04/2025, o modelo pode estar vendo o HTML de um site que não é e-commerce e que foi rotulado como sendo e-commerce;
- Existem websites que foram rotulados como "Redireciona para a loja virtual" e que tiveram baixa probabilidade de ser e-commerce. Esses dados podem ser estudados de uma maneira mais aprofundada a fim de verificar se é melhor rotulá-los como sendo e-commerce ou não, para depois serem utilizados no incremento da base de dados do modelo. Esse foi somente um exemplo, mas isso pode ser feito para todos os casos em que o modelo não está classificando corretamente quando é e-commerce (casos específicos que não foram mapeados e não se encontram no conjunto de treino);
- Uma limitação das bases de dados novas é que elas possuem menos casos positivos (quando um site é e-commerce) e podem ter ocorrências de dados que foram rotulados de maneira errada (um exemplo a ser citado é o que foi exemplificado no segundo item), o que pode ser uma melhoria para uma nova rodada de experimentos do modelo.

# Conclusão

No geral, todos os modelos candidatos performaram melhor do que o modelo atual. Existem alguns casos que o modelo atual performa melhor, que são quando o threshold é muito alto, e isso se deve pelo fato de que o modelo atual, na maior das vezes, performa melhor quando se trata da quantidade de falso negativo, o que tende ao favor desse modelo quando o threshold é alto. Porém, como o foco desses experimentos foi diminuir a quantidade de falso positivo, visto que é mais importante evitar deixar passar websites que não são e-commerces do que o contrário. Ademais, nos casos de validação é possível observar que o melhor modelo candidato pode variar de acordo com o conjunto de dados e o threshold (exemplo: na base de validação da Pagar.me Lista 8, o modelo que performou melhor no geral foi o treinado com dados validados e com dados extras; já no conjunto de validação, o modelo treinado somente com os dados validados teve a melhor performance; por fim, no conjunto de dados de análise de probabilidade da Pagar.me, tanto o modelo treinado somente com dados validados quanto o que foi treinado com dados extras tiveram o melhor resultado, dependendo do valor do threshold). Sendo assim, o modelo escolhido como sendo o melhor foi treinado somente com dados validados e um threshold no valor 0.6, visto que essa combinação obtém o melhor resultado em 2 dos 3 conjuntos de validação, nesse que não possui a melhor performance ele fica em segundo lugar e supera o resultado do modelo atual, além de ter um balanço interessante entre a quantidade de ocorrência entre falso positivo e falso negativo.

Como próximos passos, o modelo treinado com dados extras também é um forte candidato ao melhor modelo, sendo assim é interessante considerar alimentar a base de treinamento com mais dados validados, de preferência com dados de website que são e-commerce, e fazer uma validação dos rótulos dessas classes, a fim de eliminar possíveis ruídos durante a etapa de treinamento do modelo. Além disso, também pode ser estudada a possibilidade de testar novas features (exemplo: ver se tem carrinho ou não, se tem checkout ou não), novos modelos mais robutos (exemplo: XGBoost, Random Forest, dentre outros) ou um novo modelo de treinamento (exemplo: ao invés de treinar um modelo para classificar se é ou não e-commerce, procurar uma maneira de treinar somente com a classe de e-commerce, como uma espécie de detecção de anomalias). Assim como foi citado antes, a validação dos dados da base de validação e teste também é imprescindível para garantir a qualidade dos resultados dos modelos e suas comparações.

# Appendix

## Modelo Treinado com Dados Validados e Sem Ruídos vs Modelo Atual

### Threshold 0.4

Modelo candidato:

array([[217,  23],
       [  5, 124]])

Modelo atual:

array([[211,  29],
       [  3, 126]])
       
### Threshold 0.5

Modelo candidato:

array([[221,  19],
       [  6, 123]])

Modelo atual:

array([[211,  29],
       [  3, 126]])
       
### Threshold 0.6

Modelo candidato:

array([[223,  17],
       [  8, 121]])

Modelo atual:

array([[212,  28],
       [  5, 124]])

### Threshold 0.7

Modelo candidato:

array([[229,  11],
       [ 13, 116]])

Modelo atual:

array([[212,  28],
       [  5, 124]])
      
### Threshold 0.8

Modelo candidato:

array([[232,   8],
       [ 15, 114]])

Modelo atual:

array([[214,  26],
       [  5, 124]])
       
### Threshold 0.9

Modelo candidato:

array([[233,   7],
       [ 23, 106]])

Modelo atual:

array([[223,  17],
       [ 12, 117]])
      
## Modelo Treinado com Dados Validados e Sem Ruídos + Dados Extras vs Modelo Atual

### Threshold 0.4

Modelo candidato:

array([[502,  30],
       [ 29, 140]])
       
Modelo atual:

array([[424, 108],
       [ 20, 149]])
       
### Threshold 0.5

Modelo candidato:

array([[514,  18],
       [ 35, 134]])

Modelo atual:

array([[461,  71],
       [ 24, 145]])
       
### Threshold 0.6

Modelo candidato:

array([[519,  13],
       [ 40, 129]])

Modelo atual:

array([[483,  49],
       [ 35, 134]])
  
### Threshold 0.7

Modelo candidato:

array([[520,  12],
       [ 52, 117]])

Modelo atual:

array([[494,  38],
       [ 37, 132]])
       
### Threshold 0.8

Modelo candidato:

array([[522,  10],
       [ 61, 108]])

Modelo atual:

array([[497,  35],
       [ 37, 132]])
      
### Threshold 0.9

Modelo candidato:

array([[525,   7],
       [ 74,  95]])

Modelo atual:

array([[513,  19],
       [ 45, 124]])
       
## Modelo Treinado com Ruídosos vs Modelo Atual

### Threshold 0.4

Modelo candidato:

array([[1078,  124],
       [  33,  352]])

Modelo atual:

array([[891, 311],
       [  9, 376]])
       
### Threshold 0.5

Modelo candidato:

array([[1092,  110],
       [  43,  342]])

Modelo atual:

array([[969, 233],
       [ 10, 375]])
       
### Threshold 0.6

Modelo candidato:

array([[1092,  110],
       [  43,  342]])

Modelo atual:

array([[999, 203],
       [ 11, 374]])
       
### Threshold = 0.7

Modelo candidato:

array([[1119,   83],
       [  59,  326]])

Modelo atual:

array([[1020,  182],
       [  13,  372]])
       
### Threshold 0.8

Modelo candidato:

array([[1130,   72],
       [  75,  310]])

Modelo atual:

array([[1044,  158],
       [  23,  362]])
       
### Threshold 0.9

Modelo candidato:

array([[1147,   55],
       [ 105,  280]])

Modelo atual:

array([[1074,  128],
       [  42,  343]])